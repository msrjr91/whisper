{% extends 'main.html' %}

{% block content %}


<div class="container text-center">
  <div class="row">

    <div class="col">
      <div class="container text-center">
        <div class="container text-center">
          <img src="{{profile.avatar.url}}" alt={{user.id}} style="height: 200px; width: 200px; object-fit: cover; border-radius: 50%;"/>
          <h4>@{{user.username}}</h4>
          <hr>
          <h5>Followers: {{profile.followed_by.all.count}}</h5>
          <h5>Posts: {{post_count}}</h5>
          <h5>Contributions: {{comment_count}}</h5>
          {% if profile.id == request.user.id %}
          <a href="{% url 'update-profile' request.user.id %}">Update Profile</a>
          {% endif %}
        </div>
      </div>
      {% if request.user.is_authenticated %}
      <form method="POST" action="">
        {% csrf_token %}
        {% if profile.id != request.user.id %}
          {% if profile in request.user.profile.follows.all %}
            <button class="btn btn-secondary" name="follow" value="unfollow" type="submit">
              Unfollow @{{profile.user.username}}
            </button>
          {% else %}
            <button class="btn btn-primary" name="follow" value="follow" type="submit">
              Follow @{{profile.user.username}}
            </button>
          {% endif %}
        {% endif %}
      </form>
      {% endif %}
      <br>
    </div>

    <div class="col">
      <div class="container text-start">
        <h2>@{{user.username}}'s posts</h2>
        <div class="all-posts">
          {% for post in posts %}
          <div class="profile-posts">
            <small>@{{post.user.username}} -- {{post.created|timesince}} ago</small>
            <a href="{% url 'view-post' post.id %}"><p>{{post.content}}</p></a>
            <small>{{post.category}}</small>
            <hr>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="col">
      <div class="container text-start">
        <h2>@{{user.username}}'s followers</h2>
        <div class="followers-list">
          {% for following in profile.followed_by.all %}
            {% if following != profile %}
              <!-- <img src="{{ following.avatar.url }}" alt="" style="height: 50px; width: 50px; object-fit: cover; border-radius: 50%;"/> -->
              <a href="{% url 'profile' following.user.id %}"><img src="{{ following.avatar.url }}" alt="" style="height: 50px; width: 50px; object-fit: cover; border-radius: 50%;"/> @{{ following }}</a><br>
              <hr>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
